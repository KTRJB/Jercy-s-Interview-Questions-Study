# **샌드박스란?**(sandbox)

- **샌드박스**(sandbox)란 외부로부터 들어온 프로그램이 보호된 영역에서 동작해 시스템이 부정하게 조작되는 것을 막는 보안 형태이다.
- 호스트 머신이나 운영 체제에 손상을 입히지 않고 확인되지 않거나 신뢰할 수 없는 서드파티, 공급자, 사용자, 웹사이트로부터 잠재적으로 테스트되지 않거나 신뢰하지 못하는 프로그램이나 코드를 실행하기 위해 종종 사용된다.
- 고도로 제어되는 환경을 제공한다는 측면에서 샌드박스는 가상화의 특정 예시로 간주할 수 있다. 샌드박스는 소프트웨어가 호스트 장치에 위험을 주지 않게 하면서 바이러스나 기타 악성 코드를 포함할 수 있는 미검증된 프로그램을 테스트하기 위해 종종 사용된다.

실제 예시

- 웹 브라우저에서 통합 개발 환경(IDE)을 제공하는 토츠페이먼츠 샌드박스

# iOS의 샌드박스
## iOS 샌드박스 개념

- 각 앱을 독립된 환경에서 실행하여 다른 앱이나 시스템에 대한 접근을 제한하는 보안 메커니즘
- 앱이 자신의 컨테이너 외부의 파일이나 리소스에 접근하는 것을 제한
    1. 보안 (Security)
        - 악성 앱이 다른 앱의 데이터에 무단 접근하는 것을 방지
        - 시스템 레벨 변경을 통한 악용 차단
        - 커널 수준의 조작 방지
    2. 안정성 (Stability)
        - 한 앱의 문제가 전체 시스템에 영향을 주는 것을 방지
        - 리소스 관리를 통한 성능과 배터리 수명 최적화
        - 앱 간 충돌 방지
    3. 개인정보 보호 (Privacy)
        - 사용자 동의 없는 데이터 수집 차단
        - 앱 간 무분별한 정보 공유 제한
        - 사용자 행동 추적 방지
## iOS 샌드박스 구조
![image](https://github.com/user-attachments/assets/481eec80-cd2c-4c53-b258-28c221c6e7ad)


# iOS 샌드박스의 주요 제한사항
## 1. Authorization Services API
- 시스템 수준의 권한 관리 API 사용을 제한
- 관리자 권한이 필요한 시스템 설정 변경 불가
- 목적: 앱이 시스템 권한을 획득하여 무단 변경하는 것을 방지

## 2. 접근성 API
- 앱은 자신의 접근성 기능만 구현 가능
- 다른 앱의 UI 요소 접근이나 시스템 전체 모니터링 불가
- 목적: VoiceOver 등의 악용을 통한 사용자 입력 탈취 방지

## 3. Apple Events
- 앱 간 원격 제어나 자동화된 작업 수행 제한
- 다른 앱에 대한 직접적인 명령 전송 불가
- 목적: 무단 앱 조작이나 자동화를 통한 공격 방지

## 4. Distributed Notifications
- 시스템 전체 알림을 통한 데이터 전달 제한
- 승인되지 않은 앱 간의 데이터 교환 불가
- 목적: 앱 간 비인가 통신 및 데이터 유출 방지

## 5. Kernel Extensions
- iOS 커널 수준의 기능 확장 제한
- 시스템 드라이버나 도구 설치 불가
- 목적: 시스템 안정성 보호 및 악성코드 실행 방지

## 6. 대화상자 입력 제한
- 시스템 대화상자에서 자동화된 입력 제한
- 사용자 조작 흉내 불가
- 목적: 피싱이나 무단 파일 접근 시도 방지

## 7. 앱 설정 접근
- 다른 앱의 설정 데이터 접근 및 수정 제한
- 각 앱은 자신의 설정만 관리 가능
- 목적: 앱 데이터 프라이버시 보호

## 8. 네트워크 설정
- 시스템 네트워크 구성 변경 제한
- VPN, 프록시, DNS 등의 설정 수정 불가
- 목적: 네트워크 보안 위협 방지

## 9. 프로세스 제어
- 다른 실행 중인 앱의 강제 종료 제한
- 각 앱은 자신의 프로세스만 제어 가능
- 목적: 서비스 거부 공격 및 사용자 경험 방해 방지

# Sandbox 제한에 대한 iOS의 안전한 대안

- App Groups: 제한된 앱 간 데이터 공유
- Entitlements: 특정 기능에 대한 제어된 접근 권한
- Extensions: 제한된 기능 확장
- URLSchemes: 앱 간 제한된 통신
- Universal Links: 웹-앱 간 안전한 연결

## 1. App Groups

### 개념

- 동일 Apple Developer Team ID로 서명된 앱들 간의 데이터 공유 메커니즘
- iOS의 샌드박스 정책 내에서 안전하게 데이터를 공유할 수 있는 공식적인 방법

### 지원하는 데이터 유형

1. UserDefaults: 간단한 설정값이나 상태 정보
2. Core Data: 구조화된 데이터베이스
3. 공유 파일 컨테이너: 파일 시스템 접근
4. SQLite 데이터베이스: 구조화된 데이터
5. Keychain 항목: 보안 데이터

### 주요 활용 사례

- 메인 앱과 위젯 간 데이터 공유
- 메인 앱과 Extension 간 데이터 공유
- 동일 개발팀의 여러 앱 간 데이터 공유

### 장단점과 주의사항

장점:

- 샌드박스 정책을 준수하는 안전한 데이터 공유
- 다양한 데이터 타입 지원
- 시스템이 보장하는 안정성

단점:

- 동일 개발팀 앱으로 제한
- 실시간 동기화 기능 미제공
- 초기 설정 복잡 (Capabilities, Provisioning Profile 설정 필요)

주의사항:

- 동시성 제어 필요 (여러 앱에서 동시 접근 시 데이터 일관성)
- 저장 공간 관리 (공유 컨테이너의 용량 제한 고려)
- 데이터 정합성 유지 전략 필요

## 2. Entitlements

### 개념

- 앱의 특정 기능과 보안 권한을 정의하는 키-값 쌍
- 앱이 특정 리소스나 기능에 접근할 수 있는 권한을 부여하는 메커니즘
- 앱 서명의 필수 구성 요소

### 주요 Entitlements 예시

1. com.apple.security.application-groups (App Groups)
2. com.apple.developer.associated-domains (Universal Links)
3. com.apple.developer.icloud-container-identifiers (iCloud)
4. com.apple.developer.in-app-payments (Apple Pay)

### 중요성

Entitlements는 iOS 보안 아키텍처의 핵심 요소입니다. 앱이 접근할 수 있는 시스템 리소스와 기능을 명시적으로 정의함으로써, 불필요한 권한 남용을 방지하고 사용자의 개인정보를 보호합니다.

### 장단점과 주의사항

장점:

- 명확한 권한 관리 체계
- 시스템 수준의 보안 보장
- 권한 오남용 방지

단점:

- 유료 개발자 계정 필요
- 설정 과정의 복잡성
- 권한 변경 시 앱 재배포 필요

주의사항:

- 최소 권한 원칙 준수 (필요한 권한만 요청)
- 프로비저닝 프로파일 관리
- 보안 정책 변경에 따른 대응 필요

## 3. Extensions

### 개념

- 앱의 기본 기능을 시스템의 다른 부분으로 확장하는 메커니즘
- 독립적으로 실행되는 바이너리로, 특정 기능에 특화된 미니 앱

### 지원되는 Extension 유형

1. Share Extension: 콘텐츠 공유
2. Widget Extension: 홈 화면/알림 센터 위젯
3. Photo Editing: 사진 앱 내 편집 기능
4. Document Provider: 파일 앱 연동
5. Custom Keyboard: 커스텀 키보드
6. Notification Content/Service: 알림 확장

### 특징과 동작 방식

Extensions는 메인 앱과 별도의 프로세스로 실행되며, 제한된 리소스를 사용합니다. 이는 시스템 리소스를 효율적으로 사용하기 위한 설계이며, 각 Extension 타입별로 특정한 목적과 제한사항이 있습니다.

### 장단점과 주의사항

장점:

- 앱 기능의 효과적인 확장
- 시스템 수준의 통합 제공
- 사용자 경험 향상
- 필요할 때만 로드되어 리소스 효율적

단점:

- 제한된 리소스와 실행 시간
- 메인 앱과의 제한된 통신
- 각 Extension 타입별 학습 필요
- 복잡한 설정과 관리 필요

주의사항:

- 메모리 사용량 최적화 필수
- 성능 고려 (배터리, CPU 사용량)
- 적절한 데이터 공유 방식 선택
- Extension 생명주기 관리

## 4. URL Schemes

### 개념

- 커스텀 프로토콜을 통한 앱 실행 및 데이터 전달 메커니즘
- 앱 간 기본적인 통신 방법 제공
- 예: myapp://path?param1=value1

### 작동 원리

1. 호출하는 앱에서 URL 스킴으로 요청
2. 시스템이 해당 URL 스킴 등록 앱 확인
3. 대상 앱 실행 및 파라미터 전달
4. 대상 앱에서 URL 파라미터 처리

### 장단점과 주의사항

장점:

- 구현이 단순하고 직관적
- 빠른 앱 전환 가능
- 다양한 파라미터 전달 가능
- 광범위한 지원

단점:

- 앱 설치 필요
- 보안성 상대적 취약
- URL 길이 제한
- 스킴 충돌 가능성

주의사항:

- URL 유효성 검증 필수
- 파라미터 보안 처리
- 앱 미설치 상황 대응
- 스킴 중복 방지

## 5. Universal Links

### 개념

- 웹사이트와 앱을 연결하는 표준 HTTP/HTTPS 링크
- URL Scheme을 대체할 수 있는 보다 안전한 딥링킹 방식
- 앱과 웹 사이의 원활한 전환 제공

### 필수 구성 요소

1. apple-app-site-association 파일 구성
    - Universal Links를 사용하기 위해 웹사이트에 필요한 JSON 설정 파일
    ```json
        {
            "applinks": {
                "apps": [],
                "details": [
                    {
                        "appID": "TEAM_ID.BUNDLE_ID",
                        "paths": ["*"],
                        "components": [{
                            "/": "/path/*",
                            "exclude": true,
                            "comment": "Matches any URL with a path that starts with /path/"
                        }]
                    }
                ]
            }
        }
    ```
    - 앱과 웹사이트 간의 연결을 검증하는 메커니즘
    - 도메인의 루트 또는 .well-known 디렉토리에 위치
2. Associated Domains 엔타이틀먼트 설정
3. HTTPS 프로토콜 지원
4. 도메인 소유권 검증
5. 앱에서의 Universal Links 처리 구현

### 장단점과 주의사항

장점:

- 향상된 보안성 (도메인 기반 검증)
- 끊김없는 웹-앱 전환
- 앱 미설치시 자동 웹 페이지 이동
- URL 스킴보다 신뢰성 높음

단점:

- 초기 설정의 복잡성
- HTTPS 도메인 필요
- 지속적인 AASA 파일 관리 필요
- 설정 과정의 번거로움

주의사항:

- AASA 파일 정기적 유효성 검사
- 도메인 인증 상태 모니터링
- 웹페이지 폴백 동작 검증
- 딥링크 처리 로직 철저한 테스트

